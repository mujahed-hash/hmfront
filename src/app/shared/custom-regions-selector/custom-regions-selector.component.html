<div class="custom-regions-selector" 
     [class.disabled]="disabled"
     [class.open]="isOpen"
     (click)="toggleDropdown()">
  
  <!-- Selected Value Display -->
  <div class="selector-display" [class.has-selection]="selectedRegions.length > 0">
    <div class="selected-content">
      <div class="selected-icon">
        <mat-icon>location_on</mat-icon>
      </div>
      <div class="selected-text-container">
        <span class="selected-text" [class.placeholder]="selectedRegions.length === 0">{{ getDisplayText() }}</span>
      </div>
    </div>
    <div class="dropdown-arrow" [class.rotated]="isOpen">
      <mat-icon>keyboard_arrow_down</mat-icon>
    </div>
  </div>

  <!-- Dropdown Options -->
  <div class="dropdown-options" 
       *ngIf="isOpen" 
       [style.max-height]="maxHeight">
    
    <!-- Search Input -->
    <div class="search-container" *ngIf="searchable">
      <div class="search-input-wrapper">
        <mat-icon class="search-icon">search</mat-icon>
        <input type="text" 
               class="search-input"
               placeholder="Search regions..."
               [value]="searchTerm"
               (input)="onSearchChange($event)"
               (click)="$event.stopPropagation()">
        <!-- <button class="clear-search-btn" 
                *ngIf="searchTerm" 
                (click)="clearSearch(); $event.stopPropagation()"
                type="button">
          <mat-icon>close</mat-icon>
        </button> -->
      </div>
    </div>

    <!-- All Option -->
    <div class="option-item all-option" 
         *ngIf="showAllOption"
         (click)="selectRegion(null); $event.stopPropagation()"
         [class.selected]="isAllRegionsSelected">
      <div class="option-icon">
        <mat-icon>public</mat-icon>
      </div>
      <span class="option-text">{{ allOptionText }}</span>
      <div class="option-check" *ngIf="isAllRegionsSelected">
        <mat-icon>check</mat-icon>
      </div>
    </div>

    <!-- Region Options -->
    <div class="options-list">
      <div class="option-item" 
           *ngFor="let region of filteredRegions; trackBy: trackByRegion"
           (click)="selectRegion(region); $event.stopPropagation()"
           [class.selected]="selectedRegions.includes(region)"
           [class.multiple-mode]="multiple">
        
        <div class="option-icon">
          <mat-icon>location_on</mat-icon>
        </div>
        
        <div class="option-content">
          <span class="option-text">{{ region }}</span>
        </div>
        
        <!-- Checkbox for multiple selection -->
        <div class="option-check" 
             *ngIf="multiple && selectedRegions.includes(region)">
          <mat-icon>check_box</mat-icon>
        </div>
        
        <!-- Empty checkbox for unselected items in multiple mode -->
        <div class="option-check-empty" 
             *ngIf="multiple && !selectedRegions.includes(region)">
          <mat-icon>check_box_outline_blank</mat-icon>
        </div>
        
        <!-- Single selection check -->
        <div class="option-check" 
             *ngIf="!multiple && selectedRegions.includes(region)">
          <mat-icon>check</mat-icon>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="filteredRegions.length === 0 && searchTerm">
      <mat-icon>search_off</mat-icon>
      <span>No regions found</span>
    </div>
  </div>
</div>

